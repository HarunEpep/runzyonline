"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&["log","debug","info","warn","error","table","clear"].forEach(e=>{console[e]=function(){}});let supabaseClient=null,ADMIN_USERNAME="admin",ADMIN_PASSWORD="admin123";const AUTH_KEY="runzy_admin_auth";let localScripts=[];document.addEventListener("DOMContentLoaded",async function(){async function e(){try{let e=await fetch("/api/config");if(!e.ok)throw Error("Gagal mengambil config");let t=await e.json();t.SUPABASE_URL&&t.SUPABASE_KEY&&window.supabase?(supabaseClient=window.supabase.createClient(t.SUPABASE_URL,t.SUPABASE_KEY),console.log("Supabase initialized via API config")):console.error("Config Supabase tidak lengkap atau SDK tidak dimuat"),t.ADMIN_USERNAME&&t.ADMIN_PASSWORD&&(ADMIN_USERNAME=t.ADMIN_USERNAME,ADMIN_PASSWORD=t.ADMIN_PASSWORD,console.log("Admin credentials loaded from config"))}catch(a){console.error("Error initializing Supabase:",a)}}async function t(){if(!supabaseClient){console.error("Supabase client belum diinisialisasi.");return}try{let{data:e,error:t}=await supabaseClient.from("scripts").select("*").order("created_at",{ascending:!0});if(t)throw t;localScripts=e.map(e=>({...e,features:"string"==typeof e.features?e.features.split(","):Array.isArray(e.features)?e.features:[]})),s()}catch(a){console.error("Error fetching scripts:",a)}}function a(){return localScripts}function i(){let e="true"===sessionStorage.getItem(AUTH_KEY);return e}function n(){document.getElementById("adminLoginToggle")?.classList.add("hidden"),document.getElementById("logoutBtn")?.classList.remove("hidden"),document.getElementById("adminPanel")?.classList.remove("hidden")}function l(){document.getElementById("adminLoginToggle")?.classList.remove("hidden"),document.getElementById("logoutBtn")?.classList.add("hidden"),document.getElementById("adminPanel")?.classList.add("hidden")}function s(){let e=document.getElementById("scriptListContainer");if(!e){console.error("Container not found!");return}let t=localScripts,a=i();if(e.innerHTML="",0===t.length){e.innerHTML='<p style="text-align:center; padding:2rem; color:#666;">Belum ada script. Admin bisa menambahkan script baru.</p>';return}t.forEach((t,i)=>{let n=document.createElement("div");n.className="script-card",n.style.animationDelay=`${(i+1)*.1}s`;let l=t.features.map(e=>`<span><i class="fas fa-check"></i> ${e}</span>`).join(""),s="";if(t.image&&""!==t.image.trim()){let d=t.image.startsWith("http")?t.image:"https://placehold.co/300x180/e0e0e0/666666/png?text=Script+Image";s=`<div class="script-img-wrap"><img src="${d}" alt="${t.name}" class="script-img" onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\\'padding:2rem;text-align:center;background:#f3f4f6;border-radius:12px;color:#666;\\'><i class=\\'fas fa-image\\' style=\\'font-size:3rem;margin-bottom:1rem;\\'></i><p>Gambar tidak tersedia</p></div>'"></div>`}let r=`Halo%20saya%20mau%20beli%20script%20${encodeURIComponent(t.name)}`,o=t.downloadLink&&""!==t.downloadLink.trim(),c=o?`<a href="${t.downloadLink}" class="btn btn-download" target="_blank">
                       <i class="fas fa-download"></i> Download
                   </a>`:`<a href="https://wa.me/${t.waNumber}?text=${r}" class="btn btn-beli" target="_blank">
                       <i class="fab fa-whatsapp"></i> Beli
                   </a>`;if(n.innerHTML=`
                ${s}
                <div class="script-header">
                    <h3>${t.name}</h3>
                    <span class="badge ${t.badge}">${t.badgeText}</span>
                </div>
                <p>${t.description}</p>
                <div class="script-price">
                    <i class="fas fa-tag"></i> <strong>${t.price||"Hubungi Admin"}</strong>
                </div>
                <div class="script-features">${l}</div>
                <div class="script-links">
                    <a href="${t.youtubeLink}" class="btn-link btn-preview" target="_blank">
                        <i class="fab fa-youtube"></i> Preview
                    </a>
                    ${c}
                </div>
            `,a){let m=document.createElement("div");m.className="admin-buttons",m.innerHTML=`
                    <button class="btn-edit" data-index="${i}">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn-delete" data-index="${i}">
                        <i class="fas fa-trash"></i> Hapus
                    </button>
                `,n.appendChild(m)}e.appendChild(n)}),a&&(document.querySelectorAll(".btn-edit").forEach(e=>{e.addEventListener("click",function(){let e=parseInt(this.dataset.index);(function e(t){let a=localScripts,i=a[t];document.getElementById("modalTitle").textContent="Edit Script",document.getElementById("submitBtnText").textContent="Update Script",document.getElementById("editIndex").value=i.id,document.getElementById("scriptName").value=i.name,document.getElementById("scriptImageUrl").value=i.image||"",document.getElementById("scriptBadge").value=i.badge,document.getElementById("scriptBadgeText").value=i.badgeText,document.getElementById("scriptDesc").value=i.description,document.getElementById("scriptFeatures").value=Array.isArray(i.features)?i.features.join(", "):i.features,document.getElementById("scriptPrice").value=i.price||"",document.getElementById("scriptYoutube").value=i.youtubeLink,document.getElementById("scriptDownload").value=i.downloadLink||"",document.getElementById("scriptWaNumber").value=i.waNumber,document.getElementById("addScriptModal").classList.remove("hidden")})(e)})}),document.querySelectorAll(".btn-delete").forEach(e=>{e.addEventListener("click",function(){let e=parseInt(this.dataset.index);d(e)})}))}async function d(e){if(confirm("Apakah Anda yakin ingin menghapus script ini?")){let a=localScripts,i=a[e];if(!i||!i.id){r("Gagal menghapus: ID tidak ditemukan","danger");return}try{let{error:n}=await supabaseClient.from("scripts").delete().eq("id",i.id);if(n)throw n;r("Script berhasil dihapus!","success"),t()}catch(l){console.error("Error deleting script:",l),r("Gagal menghapus script","danger")}}}function r(e,t="success"){let a=document.getElementById("notification");a||((a=document.createElement("div")).id="notification",a.className="notification",document.body.appendChild(a)),a.textContent=e,a.className=`notification ${t}`,a.style.display="flex",a.style.opacity="1",setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{a.style.display="none"},300)},3e3)}await e(),function e(){let t=i();t?n():l()}(),function e(){console.log("Setting up event listeners...");let a=document.getElementById("adminLoginToggle");if(console.log("Admin toggle button found:",a),a){let i=a.cloneNode(!0);a.parentNode.replaceChild(i,a),i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),console.log("Admin button clicked!");let t=document.getElementById("adminLoginModal");if(console.log("Modal element:",t),t){t.classList.remove("hidden");let a=document.getElementById("adminPassword");a&&setTimeout(()=>a.focus(),100)}}),console.log("Admin button event listener attached")}else console.error("Admin button not found!");let d=document.getElementById("closeLoginBtn");d&&d.addEventListener("click",function(e){e.preventDefault(),document.getElementById("adminLoginModal").classList.add("hidden"),document.getElementById("adminLoginForm").reset()});let o=document.getElementById("adminLoginForm");o&&o.addEventListener("submit",function(e){e.preventDefault();let t=document.getElementById("adminUsername").value.trim(),a=document.getElementById("adminPassword").value;if(console.log("Login attempt..."),t===ADMIN_USERNAME&&a===ADMIN_PASSWORD)sessionStorage.setItem(AUTH_KEY,"true"),document.getElementById("adminLoginModal").classList.add("hidden"),document.getElementById("adminLoginForm").reset(),n(),s(),r("Login berhasil! Selamat datang, "+t+"!","success"),console.log("Login success");else{let i="Username atau password salah!";t!==ADMIN_USERNAME&&a!==ADMIN_PASSWORD?i="Username dan password salah!":t!==ADMIN_USERNAME?i="Username salah!":a!==ADMIN_PASSWORD&&(i="Password salah!"),r(i,"danger"),console.log("Login failed:",i),document.getElementById("adminPassword").value="",document.getElementById("adminUsername").focus()}});let c=document.getElementById("logoutBtn");c&&c.addEventListener("click",function(){confirm("Yakin ingin logout?")&&(sessionStorage.removeItem(AUTH_KEY),l(),s(),r("Logout berhasil!","success"))});let m=document.getElementById("addScriptBtn");m&&m.addEventListener("click",function(){document.getElementById("modalTitle").textContent="Tambah Script Baru",document.getElementById("submitBtnText").textContent="Tambah Script",document.getElementById("editIndex").value="",document.getElementById("addScriptForm").reset(),document.getElementById("addScriptModal").classList.remove("hidden")});let g=document.getElementById("closeAddScriptBtn");g&&g.addEventListener("click",function(){document.getElementById("addScriptModal").classList.add("hidden"),document.getElementById("addScriptForm").reset()});let u=document.getElementById("addScriptForm");u&&u.addEventListener("submit",async function(e){e.preventDefault();let a=document.getElementById("editIndex").value,i={name:document.getElementById("scriptName").value.trim(),image:document.getElementById("scriptImageUrl").value.trim()||"https://placehold.co/300x180/e0e0e0/666666/png?text=Script+Image",badge:document.getElementById("scriptBadge").value,badgeText:document.getElementById("scriptBadgeText").value.trim(),description:document.getElementById("scriptDesc").value.trim(),features:document.getElementById("scriptFeatures").value.split(",").map(e=>e.trim()).filter(e=>e),price:document.getElementById("scriptPrice").value.trim()||"Hubungi Admin",youtubeLink:document.getElementById("scriptYoutube").value.trim(),downloadLink:document.getElementById("scriptDownload").value.trim()||"",waNumber:document.getElementById("scriptWaNumber").value.trim()};try{if(a){let{error:n}=await supabaseClient.from("scripts").update(i).eq("id",a);if(n)throw n;r("Script berhasil diupdate!","success")}else{let{error:l}=await supabaseClient.from("scripts").insert([i]);if(l)throw l;r("Script berhasil ditambahkan!","success")}document.getElementById("addScriptModal").classList.add("hidden"),document.getElementById("addScriptForm").reset(),t()}catch(s){console.error("Error saving script:",s),r("Gagal menyimpan script","danger")}}),document.querySelectorAll(".modal-overlay").forEach(e=>{e.addEventListener("click",function(t){t.target===e&&(e.classList.add("hidden"),"adminLoginModal"===e.id?document.getElementById("adminLoginForm").reset():"addScriptModal"===e.id&&document.getElementById("addScriptForm").reset())})})}(),t(),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();let t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})})});